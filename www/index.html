<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon-180x180.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png" />
    <link rel="icon" type="image/x-icon" href="/assets/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3b82f6" id="themeColor">
    <meta name="description" content="<%= metaDescription %>" />
    <title><%= metaTitle %></title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
	<script type="module" defer>
    // Fix flags emoji in some browsers on Windows
    import { polyfillCountryFlagEmojis } from "https://cdn.skypack.dev/country-flag-emoji-polyfill";
    polyfillCountryFlagEmojis();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <style>
:root {
    --primary-color: #3b82f6;
    --primary-hover: #2563eb;
    --background: #ffffff;
    --surface: #f8fafc;
    --border: #e2e8f0;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --text-muted: #94a3b8;
    --success: #10b981;
    --warning: #f59e0b;
    --error: #ef4444;
    --info: #3b82f6;
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    --radius: 0.5rem;
}

.dark-theme {
    --background: #0f172a;
    --surface: #1e293b;
    --border: #334155;
    --text-primary: #f1f5f9;
    --text-secondary: #cbd5e1;
    --text-muted: #94a3b8;
    --shadow: 0 1px 3px 0 rgb(0 0 0 / 0.3), 0 1px 2px -1px rgb(0 0 0 / 0.3);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.3), 0 4px 6px -4px rgb(0 0 0 / 0.3);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
    background-color: var(--background);
    color: var(--text-primary);
    line-height: 1.6;
    transition: background-color 0.3s ease, color 0.3s ease;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
}

.header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 30px;
    flex-wrap: wrap;
    gap: 20px;
}

.logo {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary-color);
}

.controls {
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
}

.btn {
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: var(--surface);
    color: var(--text-primary);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    white-space: nowrap;
}

.btn:hover {
    background: var(--border);
}

.btn-primary {
    background: var(--primary-color);
    color: white;
    border-color: var(--primary-color);
}

.btn-primary:hover {
    background: var(--primary-hover);
    border-color: var(--primary-hover);
}

.btn-sm {
    padding: 6px 12px;
    font-size: 12px;
}

.btn-icon {
    padding: 8px;
    min-width: 40px;
    justify-content: center;
}

.card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    overflow: hidden;
}

.card-header {
    padding: 20px;
    border-bottom: 1px solid var(--border);
    font-weight: 600;
    font-size: 18px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.card-content {
    padding: 20px;
}

.user-info {
    display: grid;
    gap: 16px;
    margin-bottom: 30px;
}

.info-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
}

.info-row:last-child {
    border-bottom: none;
}

.info-label {
    color: var(--text-secondary);
    font-weight: 500;
}

.info-value {
    color: var(--text-primary);
    font-weight: 600;
    text-align: right;
    word-break: break-word;
}

.badge {
    padding: 4px 8px;
    border-radius: 9999px;
    font-size: 12px;
    font-weight: 500;
    text-transform: uppercase;
}

.badge-active {
    background: #dcfce7;
    color: #166534;
}

.badge-disabled, .badge-limited, .badge-expired {
    background: #fee2e2;
    color: #991b1b;
}

.dark-theme .badge-active {
    background: #14532d;
    color: #bbf7d0;
}

.dark-theme .badge-disabled, .dark-theme .badge-limited, .dark-theme .badge-expired {
    background: #7f1d1d;
    color: #fecaca;
}

.links-section {
    margin-bottom: 30px;
}

.link-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    margin-bottom: 12px;
    background: var(--surface);
}

.link-info {
    flex: 1;
    min-width: 0;
}

.link-name {
    font-weight: 500;
    margin-bottom: 4px;
    word-break: break-word;
    font-family: "Twemoji Country Flags", system-ui, -apple-system, Roboto, "Segoe UI", "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
}

.link-actions {
    display: flex;
    gap: 8px;
}

.apps-section {
    margin-bottom: 30px;
}

.platform-tabs {
    display: flex;
    gap: 8px;
    margin-bottom: 20px;
    background: var(--surface);
    padding: 4px;
    border-radius: var(--radius);
    border: 1px solid var(--border);
    flex-wrap: nowrap;
    overflow-x: auto;
}

.platform-tab {
    flex: 1 0 auto;
    padding: 8px 16px;
    text-align: center;
    border-radius: calc(var(--radius) - 2px);
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 500;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    min-width: 80px;
}

.platform-tab.active {
    background: var(--primary-color);
    color: white;
}

#platform-selector-btn {
    display: none;
}

.apps-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.featured-apps-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
}

.other-apps-spoiler {
    width: 100%;
}

.spoiler-header {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 12px 16px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: all 0.2s ease;
    font-weight: 500;
    width: 100%;
    box-sizing: border-box;
}

.spoiler-header:hover {
    background: var(--border);
}

.spoiler-content {
    display: none;
    margin-top: 8px;
}

.spoiler-content.open {
    display: block;
}

.spoiler-content .apps-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
}

.spoiler-arrow {
    transition: transform 0.2s ease;
    flex-shrink: 0;
}

.spoiler-arrow.open {
    transform: rotate(180deg);
}

.apps-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 16px;
}

.app-card {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    position: relative;
    transition: all 0.2s ease;
    cursor: pointer;
    width: 100%;
}

.app-card:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-lg);
}

.app-card.featured {
    border-color: var(--primary-color);
    background: linear-gradient(135deg, var(--surface) 0%, rgba(59, 130, 246, 0.05) 100%);
}

.app-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
}

.app-icon {
    width: 40px;
    height: 40px;
    border-radius: var(--radius);
    background: var(--primary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    flex-shrink: 0;
}

.app-name {
    font-weight: 600;
    font-size: 16px;
}

.featured-badge {
    position: absolute;
    top: -1px;
    right: -1px;
    background: var(--primary-color);
    color: white;
    padding: 4px 8px;
    border-radius: 0 var(--radius) 0 var(--radius);
    font-size: 10px;
    font-weight: 500;
    text-transform: uppercase;
}

.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--surface);
    border-radius: var(--radius);
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: var(--shadow-lg);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    border-bottom: 1px solid var(--border);
}

.modal-title {
    font-size: 18px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: "Twemoji Country Flags", system-ui, -apple-system, Roboto, "Segoe UI", "Helvetica Neue", "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
}

.modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: var(--text-secondary);
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 4px;
}

.modal-close:hover {
    background: var(--border);
}

.modal-body {
    padding: 20px;
}

.step {
    margin-bottom: 24px;
}

.step-title {
    font-weight: 600;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.step-number {
    background: var(--primary-color);
    color: white;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    flex-shrink: 0;
}

.step-description {
    color: var(--text-secondary);
    margin-bottom: 12px;
    line-height: 1.5;
}

.step-buttons {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.step-buttons .btn {
    flex-grow: 1;
}

.qr-container {
    text-align: center;
    padding: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
}

.qr-container > div > img {
    max-width: 100%;
    height: auto;
    display: block;
    justify-content: center;
}

.qr-code {
    margin: 20px auto;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    background: white;
    padding: 16px;
    display: inline-block;
}

.error-card {
    background: #fef2f2;
    border: 1px solid #fecaca;
    color: #991b1b;
    text-align: center;
    padding: 40px 20px;
}

.dark-theme .error-card {
    background: #7f1d1d;
    border-color: #991b1b;
    color: #fecaca;
}

.toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background: var(--success);
    color: white;
    padding: 12px 20px;
    border-radius: var(--radius);
    z-index: 1001;
    transform: translateX(400px);
    transition: transform 0.3s ease;
}

.toast.show {
    transform: translateX(0);
}

.footer {
    text-align: center;
    padding: 20px;
    color: var(--text-muted);
    font-size: 14px;
    border-top: 1px solid var(--border);
    margin-top: 40px;
}

.platform-modal-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
}
.platform-modal-item {
    padding: 12px 16px;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    cursor: pointer;
    transition: background-color 0.2s ease;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 500;
}
.platform-modal-item:hover {
    background-color: var(--border);
}


.w-4 { width: 1rem; }
.h-4 { height: 1rem; }
.w-6 { width: 1.5rem; }
.h-6 { height: 1.5rem; }

@media (min-width: 769px) {
    .featured-apps-row {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
    }
    .featured-apps-row .app-card {
        flex: 0 0 calc(33.333% - 11px);
        min-width: 280px;
        max-width: calc(33.333% - 11px);
    }
    @media (min-width: 1200px) {
        .featured-apps-row .app-card {
            flex: 0 0 calc(30% - 11px);
            max-width: calc(30% - 11px);
        }
    }
    .other-apps-spoiler {
        width: 100%;
        margin-top: 20px;
    }
    .spoiler-header { box-sizing: border-box; }
    .spoiler-content .apps-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
    }
    .spoiler-content .app-card {
        flex: 0 0 calc(33.333% - 11px);
        min-width: 280px;
        max-width: calc(33.333% - 11px);
    }
    @media (min-width: 1200px) {
        .spoiler-content .app-card {
            flex: 0 0 calc(30% - 11px);
            max-width: calc(30% - 11px);
        }
    }
    .apps-grid {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
    }
    .apps-grid .app-card {
        flex: 0 0 calc(33.333% - 11px);
        min-width: 280px;
        max-width: calc(33.333% - 11px);
    }
    @media (min-width: 1200px) {
        .apps-grid .app-card {
            flex: 0 0 calc(30% - 11px);
            max-width: calc(30% - 11px);
        }
    }
}

@media (max-width: 768px) {
    .container { padding: 16px; }
    .header { gap: 12px; }
    .logo { font-size: 20px; flex: 1; }
    .controls { gap: 8px; }
    .btn-text, .btn-icon-text { display: none; }
    .apps-container, .featured-apps-row, .spoiler-content .apps-grid, .apps-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
    }
    .featured-apps-row .app-card, .spoiler-content .app-card, .apps-grid .app-card {
        flex: none;
        max-width: none;
    }
    
    .link-item {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
    }
    .link-actions { justify-content: flex-end; }
    
    .step-buttons { flex-direction: column; }

    .platform-tabs { display: none !important; }
    #platform-selector-btn { display: inline-flex !important; }
}

.hidden { display: none !important; }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo"><%= metaTitle %></div>
            <div class="controls">
                <button class="btn btn-icon" onclick="openModal('settingsModal')">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
                    <span class="btn-text" data-key="settings">Settings</span>
                </button>
                <button class="btn btn-primary btn-icon" onclick="showSubscriptionModal()">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.102m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg>
                    <span class="btn-text" data-key="get_link">Get Link</span>
                </button>
            </div>
        </header>

        <main id="mainContent"></main>

        <footer class="footer"><%= metaDescription %></footer>
    </div>

    <!-- Modals -->
    <div class="modal" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-key="settings">Settings</h3>
                <button class="modal-close" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="step">
                    <div class="step-title" data-key="theme">Theme</div>
                    <div class="step-buttons">
                        <button class="btn" onclick="setTheme('light')" data-key="light">Light</button>
                        <button class="btn" onclick="setTheme('dark')" data-key="dark">Dark</button>
                        <button class="btn" onclick="setTheme('auto')" data-key="auto">Auto</button>
                    </div>
                </div>
                <div class="step">
                    <div class="step-title" data-key="language">Language</div>
                    <div class="step-buttons" id="languageButtons">
                        <!-- Language buttons will be dynamically inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="qrModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="qrModalTitle" data-key="qr_code">QR Code</h3>
                <button class="modal-close" onclick="closeModal('qrModal')">&times;</button>
            </div>
            <div class="modal-body"><div class="qr-container"><div id="qrCode"></div><p data-key="scan_with_phone" style="margin-top: 1rem;">Scan with your phone</p></div></div>
        </div>
    </div>
    
    <div class="modal" id="platformModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-key="select_platform">Select Platform</h3>
                <button class="modal-close" onclick="closeModal('platformModal')">&times;</button>
            </div>
            <div class="modal-body" id="platformModalBody">
                <!-- Platform list will be rendered here by JS -->
            </div>
        </div>
    </div>

    <div class="modal" id="appModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="appModalTitle"></h3>
                <button class="modal-close" onclick="closeModal('appModal')">&times;</button>
            </div>
            <div class="modal-body" id="appModalBody"></div>
        </div>
    </div>

    <div class="modal" id="subscriptionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-key="subscription_link">Subscription Link</h3>
                <button class="modal-close" onclick="closeModal('subscriptionModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="qr-container">
                    <div id="subscriptionQrCode"></div>
                    <p data-key="scan_with_phone" style="margin-top: 1rem;">Scan with your phone</p>
                </div>
                <div class="step-buttons" style="justify-content: center; display: flex;">
                     <button class="btn btn-primary" onclick="copySubscriptionUrl()">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        <span data-key="copy">Copy</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        let panelData = null, appsConfig = null, currentLanguage = 'en', currentPlatform = 'android', toastTimeout = null, validPlatforms = [], branding = null;

        const translations = {
            en: {
                settings: 'Settings', get_link: 'Get Link', theme: 'Theme', language: 'Language',
                light: 'Light', dark: 'Dark', auto: 'Auto',
                username: 'Username', status: 'Status', expires_at: 'Expires', days_left: 'Days Left',
                traffic_used: 'Traffic Used', traffic_limit: 'Traffic Limit', traffic_reset: 'Traffic Reset',
                never_expires: 'Never expires', unlimited: 'Unlimited',
                ACTIVE: 'Active', DISABLED: 'Disabled', LIMITED: 'Limited', EXPIRED: 'Expired',
                NO_RESET: 'No reset', DAY: 'Daily', WEEK: 'Weekly', MONTH: 'Monthly',
                subscription_links: 'Subscription Links', subscription_link: 'Subscription Link',
                copy: 'Copy', qr_code: 'QR Code', copied: 'Copied!', scan_with_phone: 'Scan with your phone',
                available_apps: 'Available Apps', other_apps: 'Other Apps', featured: 'Recommended',
                install_app: 'Install and Run', add_subscription: 'Add Subscription', connect_use: 'Connect & Use',
                ios: 'iOS', android: 'Android', windows: 'Windows', macos: 'macOS', linux: 'Linux',
                androidTV: 'Android TV', appleTV: 'Apple TV',
                no_data: 'No data to display', error_loading_apps: 'Error loading apps configuration',
                step_install: 'Installation', step_add_subscription: 'Add Subscription', step_connect: 'Connect & Use',
                close: 'Close', or: 'or', select_platform: 'Select Platform', support: 'Support', additional_step: 'Additional Step'
            },
            ru: {
                settings: 'Настройки', get_link: 'Получить ссылку', theme: 'Тема', language: 'Язык',
                light: 'Светлая', dark: 'Темная', auto: 'Авто',
                username: 'Имя пользователя', status: 'Статус', expires_at: 'Истекает', days_left: 'Дней осталось',
                traffic_used: 'Трафик использован', traffic_limit: 'Лимит трафика', traffic_reset: 'Сброс трафика',
                never_expires: 'Бессрочно', unlimited: 'Без лимита',
                ACTIVE: 'Активен', DISABLED: 'Отключен', LIMITED: 'Ограничен', EXPIRED: 'Истек',
                NO_RESET: 'Без сброса', DAY: 'Ежедневно', WEEK: 'Еженедельно', MONTH: 'Ежемесячно',
                subscription_links: 'Ссылки подписки', subscription_link: 'Ссылка на подписку',
                copy: 'Копировать', qr_code: 'QR-код', copied: 'Скопировано!', scan_with_phone: 'Отсканируйте телефоном',
                available_apps: 'Доступные приложения', other_apps: 'Другие приложения', featured: 'Рекомендуется',
                install_app: 'Установить и запустить', add_subscription: 'Добавить подписку', connect_use: 'Подключение и использование',
                ios: 'iOS', android: 'Android', windows: 'Windows', macos: 'macOS', linux: 'Linux',
                androidTV: 'Android TV', appleTV: 'Apple TV',
                no_data: 'Нет данных для отображения', error_loading_apps: 'Ошибка загрузки конфигурации приложений',
                step_install: 'Установка', step_add_subscription: 'Добавление подписки', step_connect: 'Подключение и использование',
                close: 'Закрыть', or: 'или', select_platform: 'Выберите платформу', support: 'Поддержка', additional_step: 'Дополнительный шаг'
            },
            fa: {
                settings: 'تنظیمات', get_link: 'دریافت لینک', theme: 'تم', language: 'زبان',
                light: 'روشن', dark: 'تیره', auto: 'خودکار',
                username: 'نام کاربری', status: 'وضعیت', expires_at: 'انقضا', days_left: 'روز باقیمانده',
                traffic_used: 'ترافیک استفاده شده', traffic_limit: 'محدودیت ترافیک', traffic_reset: 'بازنشانی ترافیک',
                never_expires: 'هرگز منقضی نمی‌شود', unlimited: 'نامحدود',
                ACTIVE: 'فعال', DISABLED: 'غیرفعال', LIMITED: 'محدود', EXPIRED: 'منقضی شده',
                NO_RESET: 'بدون بازنشانی', DAY: 'روزانه', WEEK: 'هفتگی', MONTH: 'ماهانه',
                subscription_links: 'لینک‌های اشتراک', subscription_link: 'لینک اشتراک',
                copy: 'کپی', qr_code: 'کد QR', copied: 'کپی شد!', scan_with_phone: 'با تلفن اسکن کنید',
                available_apps: 'اپلیکیشن‌های موجود', other_apps: 'سایر اپلیکیشن‌ها', featured: 'پیشنهادی',
                install_app: 'نصب و اجرا', add_subscription: 'افزودن اشتراک', connect_use: 'اتصال و استفاده',
                ios: 'iOS', android: 'اندروید', windows: 'ویندوز', macos: 'macOS', linux: 'لینوکس',
                androidTV: 'اندروید تی‌وی', appleTV: 'اپل تی‌وی',
                no_data: 'داده‌ای برای نمایش وجود ندارد', error_loading_apps: 'خطا در بارگذاری پیکربندی اپلیکیشن‌ها',
                step_install: 'نصب', step_add_subscription: 'افزودن اشتراک', step_connect: 'اتصال و استفاده',
                close: 'بستن', or: 'یا', select_platform: 'انتخاب پلتفرم', support: 'پشتیبانی', additional_step: 'مرحله اضافی'
            },
            zh: {
                settings: '设置', get_link: '获取链接', theme: '主题', language: '语言',
                light: '浅色', dark: '深色', auto: '自动',
                username: '用户名', status: '状态', expires_at: '到期时间', days_left: '剩余天数',
                traffic_used: '已用流量', traffic_limit: '流量限制', traffic_reset: '流量重置',
                never_expires: '永不过期', unlimited: '无限',
                ACTIVE: '有效', DISABLED: '禁用', LIMITED: '受限', EXPIRED: '过期',
                NO_RESET: '不重置', DAY: '每日', WEEK: '每周', MONTH: '每月',
                subscription_links: '订阅链接', subscription_link: '订阅链接',
                copy: '复制', qr_code: '二维码', copied: '已复制!', scan_with_phone: '用手机扫描',
                available_apps: '可用应用', other_apps: '其他应用', featured: '推荐',
                install_app: '安装并运行', add_subscription: '添加订阅', connect_use: '连接并使用',
                ios: 'iOS', android: '安卓', windows: 'Windows', macos: 'macOS', linux: 'Linux',
                androidTV: '安卓电视', appleTV: 'Apple TV',
                no_data: '无数据显示', error_loading_apps: '加载应用配置出错',
                step_install: '安装', step_add_subscription: '添加订阅', step_connect: '连接并使用',
                close: '关闭', or: '或', select_platform: '选择平台', support: '客服', additional_step: '附加步骤'
            },
            tr: {
                settings: 'Ayarlar', get_link: 'Bağlantıyı Al', theme: 'Tema', language: 'Dil',
                light: 'Açık', dark: 'Koyu', auto: 'Otomatik',
                username: 'Kullanıcı adı', status: 'Durum', expires_at: 'Bitiş tarihi', days_left: 'Kalan gün',
                traffic_used: 'Kullanılan trafik', traffic_limit: 'Trafik limiti', traffic_reset: 'Trafik sıfırlama',
                never_expires: 'Süresiz', unlimited: 'Sınırsız',
                ACTIVE: 'Aktif', DISABLED: 'Devre dışı', LIMITED: 'Sınırlı', EXPIRED: 'Süresi doldu',
                NO_RESET: 'Sıfırlama yok', DAY: 'Günlük', WEEK: 'Haftalık', MONTH: 'Aylık',
                subscription_links: 'Abonelik bağlantıları', subscription_link: 'Abonelik bağlantısı',
                copy: 'Kopyala', qr_code: 'QR kodu', copied: 'Kopyalandı!', scan_with_phone: 'Telefonunuzla tarayın',
                available_apps: 'Mevcut uygulamalar', other_apps: 'Diğer uygulamalar', featured: 'Önerilen',
                install_app: 'Yükle ve çalıştır', add_subscription: 'Abonelik ekle', connect_use: 'Bağlan ve kullan',
                ios: 'iOS', android: 'Android', windows: 'Windows', macos: 'macOS', linux: 'Linux',
                androidTV: 'Android TV', appleTV: 'Apple TV',
                no_data: 'Görüntülenecek veri yok', error_loading_apps: 'Uygulama yapılandırması yüklenirken hata oluştu',
                step_install: 'Kurulum', step_add_subscription: 'Abonelik ekleme', step_connect: 'Bağlan ve kullan',
                close: 'Kapat', or: 'veya', select_platform: 'Platform seçin', support: 'Destek', additional_step: 'Ek adım'
            },
            uz: {
                settings: 'Sozlamalar', get_link: 'Havolani olish', theme: 'Mavzu', language: 'Til',
                light: 'Yorugʻ', dark: 'Qorongʻi', auto: 'Avtomatik',
                username: 'Foydalanuvchi nomi', status: 'Holat', expires_at: 'Tugash muddati', days_left: 'Qolgan kunlar',
                traffic_used: 'Ishlatilgan trafik', traffic_limit: 'Trafik chegarasi', traffic_reset: 'Trafikni qayta tiklash',
                never_expires: 'Muddatsiz', unlimited: 'Cheksiz',
                ACTIVE: 'Faol', DISABLED: 'Oʻchirib qoʻyilgan', LIMITED: 'Cheklangan', EXPIRED: 'Muddati tugagan',
                NO_RESET: 'Qayta tiklash yoʻq', DAY: 'Kunlik', WEEK: 'Haftalik', MONTH: 'Oylik',
                subscription_links: 'Obuna havolalari', subscription_link: 'Obuna havolasi',
                copy: 'Nusxa olish', qr_code: 'QR-kod', copied: 'Nusxa olindi!', scan_with_phone: 'Telefoningiz bilan skanerlang',
                available_apps: 'Mavjud ilovalar', other_apps: 'Boshqa ilovalar', featured: 'Tavsiya etilgan',
                install_app: 'Oʻrnatish va ishga tushirish', add_subscription: 'Obunani qoʻshish', connect_use: 'Ulanish va foydalanish',
                ios: 'iOS', android: 'Android', windows: 'Windows', macos: 'macOS', linux: 'Linux',
                androidTV: 'Android TV', appleTV: 'Apple TV',
                no_data: 'Koʻrsatish uchun maʼlumot yoʻq', error_loading_apps: 'Ilovalar konfiguratsiyasini yuklashda xatolik yuz berdi',
                step_install: 'Oʻrnatish', step_add_subscription: 'Obuna qoʻshish', step_connect: 'Ulanish va foydalanish',
                close: 'Yopish', or: 'yoki', select_platform: 'Platformani tanlang', support: 'Yordam', additional_step: 'Qoʻshimcha qadam'
            }
        };


        const langFullNames = {
            en: 'English',
            ru: 'Русский',
            fa: 'فارسی',
            zh: '中文',
            tr: 'Türkçe',
            uz: 'Oʻzbekcha'
        };

        const appIcons = {
        'v2raytun': `<svg class="w-6 h-6" viewBox="0 0 48 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="m7.878.57.052.341c.038.202.089.698.127 1.132.038.418.128 1.302.192 1.937.063.636.216 2.061.33 3.177.103 1.1.255 2.542.319 3.178.064.635.205 2.061.32 3.177.114 1.1.254 2.495.318 3.1.063.588.178 1.673.242 2.402.076.728.191 1.798.255 2.402.076.589.14 1.178.14 1.286 0 .542.445 0 .79-.977.203-.604.548-1.503.739-2.014.803-2.092 1.402-3.673 1.402-3.735.002-.035.268-.731.586-1.566.573-1.518.65-1.704 1.236-3.3.179-.466.523-1.38.765-2.015.242-.636.574-1.52.726-1.938.6-1.596 1.058-2.82 1.402-3.72l.714-1.906.369-.96h3.926c2.163 0 3.908.046 3.886.123-.012.062-.739 1.83-1.58 3.907-.854 2.092-3.594 8.818-6.104 14.955a3112.03 3112.03 0 0 1-4.843 11.856l-.306.697-4.779.047c-4.459.031-4.779.016-4.843-.232-.038-.155-.139-.776-.216-1.364-.254-2.03-.357-2.79-.561-4.34-.115-.852-.267-1.937-.318-2.402-.128-.96-.459-3.394-.637-4.572-.179-1.24-.65-4.804-.88-6.664a139.425 139.425 0 0 0-.522-3.72C1.06 8.428.92 7.36.806 6.46a75.91 75.91 0 0 0-.318-2.402C.424 3.624.309 2.788.22 2.198.144 1.594.054.988.016.834-.034.586.207.57 3.916.57h3.962ZM37.254.26c1.81-.263 5.008.063 6.117.62 2.6 1.287 3.95 2.96 4.472 5.58.344 1.72.153 3.688-.535 5.548-.166.45-.306.853-.306.9 0 .046-.306.62-.663 1.27-1.287 2.262-3.288 4.448-7.71 8.462-1.49 1.363-2.713 2.526-2.713 2.588.005.078 2.27.14 5.033.14 3.937 0 5.034.046 5.034.186 0 .217-.306 2.573-.522 3.999a47.238 47.238 0 0 0-.192 1.58c-.05.403-.153.806-.242.9-.106.108-3.407.139-9.953.123l-9.8-.047.038-.542c.038-.635.345-3.084.562-4.464l.152-.992 1.415-1.27c.765-.698 2.421-2.17 3.683-3.285 7.353-6.479 7.162-6.293 8.245-7.595 1.096-1.302 1.554-2.402 1.618-3.874.038-.884 0-1.225-.216-1.736-.663-1.581-2.448-2.186-4.155-1.41-1.16.526-1.873 1.596-2.408 3.58-.064.263-.332.279-3.263.279-3.568 0-3.428.046-3.186-1.1C28.83 4.522 32.462.911 37.254.26Z"/> </svg>`,
        'happ': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M13.4,19.6l-7.9,7.9L5,30.4h6.6L13.4,19.6z" /><path d="M13.2,13.5L14.6,5l-7.9,7.9L4.2,27.4l7.9-7.9l0.2-1.2h1l4.9-4.9H13.2z" /><path d="M25.4,19.6L27.8,5l-7.9,7.9l-0.1,0.7h-0.6l-4.9,4.9h4.7l-1.5,9L25.4,19.6z" /><path d="M18.7,27.5l-0.5,2.9h6.6l1.8-10.8L18.7,27.5z" /><path d="M13.6,4.9l0.6-3.3H7.5L5.6,12.8L13.6,4.9z" /><path d="M18.8,12.8l7.9-7.9l0.6-3.3h-6.6L18.8,12.8z" /></svg>`,
        'sing-box': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M28.845 22.699c.608-.37.998-1.235 1-1.854V11.2s.008-.403-.417-.673L16.825 2.649s-1.48-.95-2.921 0L2.407 10.324c-.536.37-.558 1.036-.558 1.036l-.004 9.339s-.013 1.171.5 1.5l12.5 8 .048-11-12.158-7.694s-.556-.351.158-.76L14.345 3.2c1.032-.628 2.06-.03 2.06-.03l12.556 7.687c.604.254.158.444.158.444l-2.849 1.805s-.404.357-.888.112L12.356 5.134l-.48.316 13.47 8.249v3.5a.93.93 0 0 1-.362.745l-3.777 2.515s-.348.25-.362-.26v-3.5L7.43 8.359l-.542.369 13.036 8.158s.384.207-.056.446l-3.32 1.982v9.885s-.002.637-.702 1c0 0 .521.128 1.467-.432z"/></svg>`,
        'streisand': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M19.744 7.308c1.486-1.04 2.95-2.07 4.422-3.088.566-.392 1.131-.795 1.74-1.12.252-.137.625-.142.924-.095.185.028.424.246.471.42.041.152-.104.417-.251.536-.533.433-1.097.832-1.658 1.233-1.407 1.004-2.818 2.002-4.309 3.06.62.394 1.187.769 1.77 1.122.653.396.663.393 1.297-.063 1.596-1.15 3.18-2.314 4.786-3.45.276-.195.629-.341.965-.39.193-.027.54.143.606.303.073.18-.015.535-.17.666-.758.64-1.55 1.242-2.35 1.834-1.047.775-2.113 1.528-3.23 2.334.236.168.453.303.644.465.532.451 1.12.86 1.56 1.383.662.785.694 1.785.684 2.737-.014 1.28-.108 2.56-.224 3.836-.06.662-.573 1.11-1.053 1.536-.26.23-.56.42-.855.611-.3.195-.273.354.004.55 1.28.905 2.556 1.817 3.828 2.734.345.248.678.514 1.005.784.222.184.404.403.237.705-.165.299-.469.457-.784.364a3.595 3.595 0 0 1-1.006-.51c-1.432-.998-2.846-2.02-4.272-3.026a2.806 2.806 0 0 0-.585-.31c-.302-.12-.556-.166-.86.123-.402.383-.911.666-1.388.973-.29.187-.22.324.012.484 1.398.971 2.808 1.927 4.182 2.927.543.395 1.25.644 1.503 1.343l.06.168c-.249.125-.48.254-.722.36-.35.153-.638-.02-.91-.201-1.221-.816-2.438-1.637-3.66-2.452-.644-.43-1.3-.843-1.944-1.276-.232-.157-.391-.12-.621.038-.843.579-1.646 1.221-2.666 1.526-1.01.303-1.946.133-2.82-.38a21.5 21.5 0 0 1-1.688-1.112c-.297-.214-.53-.222-.83-.011-1.491 1.04-2.994 2.068-4.494 3.098-.303.208-.586.467-.922.597-.31.119-.683.135-1.022.114-.158-.01-.424-.214-.426-.334-.004-.225.078-.537.246-.667.778-.597 1.598-1.143 2.403-1.708.949-.665 1.9-1.33 2.847-1.998.127-.09.24-.195.39-.32l-1.404-1.005c-.183-.13-.353-.295-.558-.38-.43-.176-.766.08-1.081.303-1.548 1.09-3.08 2.2-4.64 3.276-.259.179-.621.285-.94.296-.186.006-.466-.21-.544-.39-.063-.144.051-.46.195-.57 1.143-.877 2.31-1.725 3.471-2.58.473-.348.946-.696 1.424-1.036.227-.161.227-.314.022-.485-.246-.206-.47-.444-.74-.615-.923-.584-1.233-1.457-1.254-2.443a90.785 90.785 0 0 1 0-4.112c.022-.935.463-1.693 1.248-2.265.415-.301.817-.619 1.223-.93.223-.171.254-.277-.03-.474-1.638-1.14-3.257-2.306-4.878-3.47a4.595 4.595 0 0 1-.527-.46c-.426-.417-.33-.827.27-.922.3-.047.7.043.948.213 1.396.95 2.758 1.946 4.133 2.923.443.315.897.613 1.333.936.305.226.552.018.768-.104.485-.272.934-.6 1.4-.903.367-.238.382-.335.03-.59C8.735 6.71 6.984 5.45 5.236 4.187c-.024-.017-.05-.03-.075-.048-.308-.22-.604-.465-.438-.879.117-.291.795-.464 1.16-.276.483.248.946.538 1.388.847a508.895 508.895 0 0 1 4.557 3.233c.247.177.466.212.727.038.378-.251.792-.459 1.147-.736 1.327-1.037 3.255-1.016 4.883.146.38.272.771.53 1.16.796zm-3.486 13.251a3.825 3.825 0 0 0 2.517-.692c2.212-1.544 4.404-3.113 6.642-4.622 1.355-.914 1.328-2.708.124-3.616-.642-.484-1.338-.902-2.005-1.358-1.299-.886-2.61-1.755-3.887-2.672-1.205-.867-2.462-1.574-4.04-1.338-.606.091-1.28.208-1.766.53-2.342 1.56-4.617 3.213-6.945 4.793-1.392.945-1.293 2.726-.093 3.61.856.631 1.768 1.193 2.651 1.791 1.254.85 2.522 1.682 3.752 2.562.913.652 1.876 1.092 3.05 1.012zm-3.646 3.53c.131.132.847.62 1.168.827.503.323.989.178 1.06-.388.077-.614.098-1.26-.024-1.862-.077-.377-.387-.798-.721-1.027-2.463-1.687-4.957-3.333-7.445-4.988-.522-.347-1.01-.196-1.084.394a6.33 6.33 0 0 0 .02 1.822c.057.347.33.706.604.96.36.334.81.583 1.24.84.106.062.213-.079.279-.141-.397-.39-.633-.531-1.053-.773-.542-.312-.768-.792-.822-1.35a4.932 4.932 0 0 1 .039-1.11c.071-.537.223-.592.676-.29l7.016 4.68c.955.636 1.317 1.72.935 2.785-.102.285-.258.36-.529.162-.26-.191-.683-.513-.968-.665-.108-.059-.145.124-.391.124zm6.435.194c-.004-.052-.323-.17-.442-.111-.236.119-.442.289-.665.431-.347.223-.512.175-.567-.227-.06-.435-.132-.897-.039-1.315.087-.393.282-.873.599-1.091 2.48-1.71 5-3.364 7.504-5.043.31-.207.5-.114.533.192.053.493.082.996.037 1.487-.046.504-.34.893-.81 1.166-.39.227-.753.498-1.128.75.008.047.325.173.43.114.32-.18.605-.417.924-.6.671-.381.935-.981.988-1.679a5.21 5.21 0 0 0-.046-1.11c-.114-.814-.546-.989-1.247-.522L18 21.475c-1.004.67-1.416 2.12-.914 3.21.195.424.529.53.935.28.35-.217.685-.454 1.027-.682zm-7.498-1.273c-.743-.497-1.481-1-2.236-1.48-.087-.055-.226.106-.362.12.732.592 1.428 1.096 2.157 1.564.109.07.43-.149.44-.204zm8.787-.002c.002.048.31.194.403.134.74-.472 1.466-.965 2.197-1.451-.008-.04-.339-.176-.436-.114-.73.464-1.445.951-2.164 1.431z"/></svg>`,
        'shadowrocket': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M26.76 23.819 20.1 22.658c-.837 1.628-2.32 2.309-4.238 2.302-1.91-.007-3.417-.646-4.3-2.344-2.183.385-4.39.77-6.734 1.182.061-.817.084-1.587.19-2.35.26-1.835 1.081-3.443 2.512-4.79.25-.233.357-.48.335-.845-.19-3.113.182-6.157 1.521-9.05a14.638 14.638 0 0 1 4.513-5.6c.51-.385 1.057-.729 1.628-1.017.205-.103.601-.083.807.027 1.3.742 2.473 1.65 3.424 2.728 1.118 1.265 2.031 2.667 2.678 4.192 1.164 2.763 1.59 5.614 1.4 8.549-.03.432.084.762.434 1.099 1.81 1.711 2.519 3.82 2.541 6.143 0 .268.008.543.016.811.007.014-.008.028-.069.124zm-1.827-1.814c.038-.103.053-.13.053-.158a.815.815 0 0 0 0-.193c-.114-1.903-.844-3.56-2.374-4.906-.16-.138-.327-.364-.32-.543.115-1.828.19-3.656-.38-5.442-.32-1.004-.548-2.041-.99-2.997-.958-2.075-2.312-3.91-4.397-5.229-.624-.399-.685-.399-1.294.028-2.58 1.786-4.185 4.157-5.068 6.947-.654 2.089-.814 4.22-.639 6.377.03.371-.091.625-.388.873-.867.707-1.46 1.587-1.856 2.577a7.172 7.172 0 0 0-.518 2.597l5.73-1.024c.122.227.22.433.335.626.631 1.044 1.598 1.642 2.93 1.683 1.377.041 2.396-.522 3.104-1.58.434-.653.434-.653 1.278-.502.038.007.069.014.107.02l4.687.846zM15.802 34c-1.126-1.546-2.222-3.03-2.55-4.824-.243-1.326.617-2.604 1.941-3.058.898-.31 1.918.02 2.587.81.624.743.822 1.595.632 2.482-.373 1.718-1.415 3.147-2.61 4.59zm-.099-2.24c.107 0 .213 0 .312-.007.342-.756.715-1.498 1.027-2.268.229-.563.023-1.1-.327-1.58-.373-.523-1.05-.57-1.545-.138-.449.392-.7.9-.525 1.43.297.865.7 1.704 1.058 2.563z"/><path d="M15.772 7.647c1.955-.048 3.477 1.374 3.485 2.996.007 1.738-1.492 3.12-3.387 3.127-1.894.006-3.332-1.327-3.393-3.058-.054-1.498 1.575-3.148 3.295-3.065zm1.94 3.106C17.727 9.79 16.928 9.014 15.9 9c-1.065-.014-2.009.742-1.994 1.724.015.949.822 1.698 1.865 1.711 1.103.007 1.925-.7 1.94-1.683z"/></svg>`,
        'clash-meta': `<svg class="w-6 h-6" viewBox="0 0 48 48" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15.1 35.17H5.686m9.282 2.993l-8.846 3.163M24 16.874c.801 0 2.551.256 2.551.256L37.746 6.674s3.295.341 4.754.852V31.63c-1.42.653-4.574 1.108-6.45 1.108V17.11l-7.756 7.302S25.708 23.560 24 23.560s-4.294.853-4.294.853L11.95 17.11v15.627c-1.876 0-5.03-.455-6.45-1.108V7.526c1.458-.511 4.754-.852 4.754-.852L21.45 17.13s1.75-.256 2.551-.256m.625 17.245L24 35.265l-.626-1.146M32.9 35.17h9.414m-9.282 2.993l8.846 3.163"/></svg>`,
        'clash-mi': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M7.21 21.241c3.34-.601 4.497-.573 4.365.029-.1.516-1.19.774-5.16 1.348-1.123.143-1.454.085-1.586-.258-.298-.631-.166-.688 2.38-1.119ZM20.967 21.241c-.132-.487.033-.516 1.72-.344 3.273.315 5.158.774 5.16 1.204 0 .688-.663.717-3.804.201-2.38-.43-2.976-.63-3.076-1.06ZM4.696 19.349c0-.573.165-.603 3.373-.517 2.943.086 3.407.145 3.506.575.099.458-.232.515-3.373.515-3.307 0-3.506-.028-3.506-.573ZM24.605 18.776c3.01 0 3.241.028 3.241.573 0 .545-.232.573-3.472.573-2.68 0-3.473-.086-3.473-.373 0-.23.1-.487.231-.573.1-.115 1.688-.2 3.473-.2ZM15.377 16.166c.397-.114.927-.143 1.159-.086.264.058.595.115.76.115.496 0 .331.517-.462 1.319l-.761.774-.728-.975-.695-.975.727-.172ZM23.415 16.654c3.339-.602 4.497-.574 4.365.028-.1.516-1.19.774-5.16 1.348-1.124.143-1.455.086-1.587-.258-.298-.63-.165-.688 2.382-1.118ZM4.762 16.654c-.132-.488.033-.516 1.72-.344 3.605.344 5.192.774 5.093 1.262-.133.544-1.423.544-4.73-.03-1.488-.258-2.017-.487-2.083-.888ZM21.397 13.328c2.083 0 3.043.66 1.984 1.319-.33.23-1.223.401-1.984.401-.76 0-1.654-.172-1.984-.401-.53-.344-.562-.46-.199-.86.298-.316.993-.46 2.183-.46ZM8.863 13.786c.165-.4.595-.458 2.249-.4 1.918.085 2.018.114 2.018.802 0 .66-.133.716-1.853.803-1.984.085-2.811-.316-2.414-1.205Z"/> <path d="M5.423.626c.53-.888 1.125-.544 3.043 1.807 1.057 1.26 1.982 2.291 2.05 2.294.033 0 .96-.201 2.018-.43 2.414-.546 5.06-.545 7.54 0 1.057.257 2.05.343 2.182.229.166-.144.993-1.118 1.853-2.237.86-1.09 1.786-2.006 2.017-2.092.232-.057.595.315.86.859 1.257 2.61 3.505 13.39 4.63 22.02.727 5.533.76 7.082.166 7.598-1.29 1.118-12.634 1.835-21.233 1.348C.463 31.42-.066 31.219.264 28.15c.562-5.477 1.588-12.615 2.282-16.371C3.406 7.336 4.894 1.486 5.423.626Zm2.944 4.387C7.044 3.379 6.349 2.748 6.349 3.178c0 .086-.43 2.007-.959 4.243-1.455 6.05-3.736 21.701-3.241 22.135.463.401 8.765.946 14.122.946 5.291 0 13.658-.545 14.121-.918.199-.172-.76-8.084-1.553-12.815-.86-4.988-2.646-12.956-2.977-13.304-.165-.143-.827.516-1.522 1.434-.661.946-1.257 1.748-1.323 1.805-.066.058-1.025-.171-2.15-.515-2.711-.774-6.15-.803-8.961-.03a72.786 72.786 0 0 1-2.117.575c-.036-.004-.663-.777-1.422-1.721Z"/> </svg>`,
        'flclashx': `<svg class="w-6 h-6" viewBox="0 0 32 48" fill="currentColor" xmlns="http://www.w3.org/2000/svg"> <path d="M27.8574 0.0380332C28.0611 0.00990742 28.4103 -0.00412593 28.6285 0.016968C31.2255 0.227929 32.906 2.61884 32.1348 5.00973C32.0548 5.24181 31.6838 5.95202 31.3055 6.58488C30.9272 7.21777 29.7706 9.14455 28.7376 10.8674C27.7046 12.5902 26.0606 15.3398 25.0785 16.9853C24.1037 18.6307 23.2745 20.0019 23.2453 20.0442C23.2162 20.0794 22.5542 21.1904 21.7758 22.5054C19.979 25.5362 15.5124 33.0324 10.893 40.7535C9.96186 42.3217 8.81245 44.2484 8.34687 45.0431C7.19022 47.005 6.66645 47.5042 5.34977 47.884C4.826 48.0387 3.77117 48.0387 3.24012 47.884C1.13776 47.2792 -0.0625635 45.2751 0.446659 43.2147C0.570327 42.6873 0.68675 42.4764 2.36717 39.6987C3.05825 38.5595 4.1349 36.7523 4.76779 35.6834C5.40068 34.6075 6.32456 33.0605 6.82651 32.2377C7.32117 31.408 8.12135 30.0649 8.60875 29.2562C9.08887 28.4405 9.89637 27.0832 10.4056 26.2324C10.9148 25.3815 12.2243 23.1804 13.3155 21.3451C14.4067 19.5097 15.5197 17.6392 15.7888 17.1962C16.058 16.7532 16.7127 15.6562 17.2438 14.7702C17.7748 13.8771 18.5022 12.6605 18.8587 12.0628C20.8228 8.77886 22.8379 5.41055 23.4853 4.32761C25.0858 1.62731 25.1876 1.47961 25.6459 1.06472C26.2715 0.509198 27.0208 0.157576 27.8574 0.0380332Z"/> <path d="M21.303 25.8597C21.4703 25.6909 21.7686 25.6558 21.9504 25.7894C22.0742 25.888 22.8091 27.1048 27.2973 34.6708C28.243 36.253 29.6688 38.6439 30.469 39.98C31.2764 41.3161 32.0112 42.5959 32.1131 42.828C32.244 43.1374 32.2949 43.4257 32.324 43.9179C32.3822 45.1556 32.0257 46.0557 31.1382 46.9065C30.338 47.68 29.5378 47.9965 28.4103 47.9965C27.2972 47.9965 26.3588 47.6308 25.6168 46.9136C25.2458 46.5549 24.9548 46.1119 23.7545 44.0937C22.4451 41.8786 18.4804 35.2545 17.542 33.7215C17.3165 33.3558 17.1346 32.9761 17.1346 32.8847C17.1346 32.7933 17.6802 31.8087 18.3422 30.7047C19.0115 29.6007 19.9135 28.0889 20.3573 27.3575C20.801 26.6192 21.2229 25.9511 21.303 25.8597Z" /> <path d="M3.62566 0.0380332C3.83662 0.00287426 4.21488 -0.011181 4.47677 0.00991195C6.06263 0.129456 7.06658 0.790469 7.99772 2.33048C8.92887 3.87753 11.1913 7.66077 11.6277 8.40617C11.8678 8.81402 12.5298 9.91807 13.0972 10.8674C15.2068 14.3623 15.6069 15.0444 15.6069 15.1499C15.6068 15.2133 15.2723 15.818 14.8722 16.493C14.4649 17.1681 13.5482 18.7222 12.8281 19.9387C12.1079 21.1552 11.4531 22.2101 11.3731 22.2733C11.1767 22.4421 10.9367 22.428 10.7548 22.2382C10.6748 22.1538 10.0419 21.1341 9.35079 19.9738C6.4264 15.0444 1.67608 7.09819 1.27598 6.47234C0.570344 5.36129 0.330241 4.68621 0.330241 3.80721C0.330248 1.98592 1.74882 0.361506 3.62566 0.0380332Z"/> </svg>`,
        'v2rayng': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M0 1.86298V3.72596H1.87780H3.75560L3.80567 17.3630L3.88078 31L18.4024 15.6987C26.3893 7.30288 32.9741 0.322916 32.9992 0.198717C33.0492 0.0993585 30.8460 -4.76837e-07 28.1169 -4.76837e-07H23.1595L16.2742 6.38381L9.38899 12.7428L9.26380 6.43349L9.13862 0.124198L4.58183 0.049679L0 -4.76837e-07V1.86298Z"/></svg>`,
        'clash-verge': `<svg class="w-6 h-6" viewBox="0 0 22 22" fill="currentColor"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.007 22C6.01025 22 0.413848 19.6085 0.0141045 14.2017C-0.0891418 12.8053 0.393020 11.8257 0.853709 10.8897C0.907577 10.7802 0.961152 10.6714 1.01346 10.5625C0.347223 7.78979 -0.385635 1.82844 2.01282 0.164802C3.51185 -0.874970 7.00960 3.28412 8.00897 4.84377C9.00832 4.32389 10.5074 4.32389 11.0070 4.32389C12.0064 4.32389 12.5061 4.32389 14.0051 4.84377C15.1710 3.11082 18.0026 -0.251107 20.0013 0.164802C22.0654 0.594314 21.4010 6.70141 21.1077 9.39799C21.0459 9.96537 21.0006 10.3818 21.0006 10.5625C21.0864 10.7409 21.1721 10.9040 21.2553 11.0623C21.6571 11.8266 22.0000 12.4790 22.0000 14.2017C22.0000 16.2813 19.0019 22.0000 11.0070 22.0000ZM8.86995 16.1663C8.39444 16.9904 6.84049 16.9834 5.39910 16.1507C3.95771 15.3180 3.17471 13.9749 3.65022 13.1507C4.12573 12.3266 5.67969 12.3336 7.12107 13.1663C8.56246 13.9990 9.34546 15.3421 8.86995 16.1663ZM18.0871 13.1507C18.5626 13.9749 17.7796 15.3180 16.3382 16.1507C14.8968 16.9834 13.3429 16.9904 12.8674 16.1663C12.3919 15.3421 13.1749 13.9990 14.6163 13.1663C16.0576 12.3336 17.6116 12.3266 18.0871 13.1507ZM11.0070 19.1585C10.0077 19.1585 8.14148 17.6696 9.50800 17.6585H12.5061C14.0051 17.6585 12.0064 19.1585 11.0070 19.1585Z"/></svg>`,
        'flclash': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M15.215 31.645a3.15 3.15 0 0 1-2.527-1.747c-.293-.585-.376-.988-.34-1.68.047-.866.355-1.542.984-2.144a3.168 3.168 0 0 1 2.23-.883c.954 0 1.653.286 2.301.934.64.64.946 1.379.95 2.297.003.91-.305 1.652-.958 2.308-.695.696-1.628 1.02-2.64.915Z"/><path d="M6.254 16.5a3.232 3.232 0 0 1-2.645-3.215c0-1.316.637-2.246 2.098-3.078l8.719-5.031C18.824 2.636 22.594.496 22.8.422c.777-.281 1.691-.223 2.504.164.515.242 1.199.934 1.453 1.465.336.707.422 1.379.27 2.094-.137.652-.4 1.12-.9 1.617-.421.418-.644.55-5.183 3.168-2.918 1.68-5.84 3.363-8.758 5.047-2.554 1.476-4.14 2.359-4.363 2.425a3.465 3.465 0 0 1-1.57.098Z"/><path d="M10.363 23.996c-.511-.137-.996-.43-1.437-.867-1.285-1.27-1.281-3.27.004-4.54.386-.378.718-.581 4.851-2.96 2.442-1.406 4.59-2.617 4.778-2.691 2.054-.833 4.367.734 4.386 2.968.008.938-.28 1.64-.949 2.305-.422.418-.617.539-4.746 2.918-4.68 2.695-4.738 2.726-5.203 2.863-.395.117-1.254.117-1.684.004Z"/></svg>`,
        'hiddify': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M26.8191 2.1691C25.0243 3.36662 23.3928 4.49636 23.2092 4.67711C22.6993 5.17420 22.6789 8.38265 23.1684 8.90233C23.6375 9.44461 30.2046 9.44461 30.6737 8.90233C30.9388 8.60860 31.0000 7.88557 31.0000 4.63192C31.0000 1.37828 30.9388 0.655248 30.6737 0.361516C30.5105 0.158163 30.3066 0 30.2250 0C30.1434 0 28.6138 0.971575 26.8191 2.1691Z" /><path d="M15.3980 9.39942C13.6033 10.5969 11.9717 11.7267 11.7882 11.9074C11.4618 12.2464 11.4211 12.8338 11.4211 18.1888C11.4211 22.4818 11.3599 24.1538 11.1763 24.3571C10.8500 24.7187 8.72895 24.7187 8.40263 24.3571C8.23947 24.1764 8.15789 22.8885 8.15789 20.0867C8.15789 16.6749 8.11711 16.0197 7.83158 15.7034C7.64803 15.5000 7.36250 15.3870 7.17895 15.4774C6.70987 15.6808 1.40724 19.2055 0.673026 19.8156L0 20.3579V25.3061C0 29.4862 0.0407895 30.2996 0.326316 30.5933C0.591447 30.8870 1.22368 30.9548 4.07895 30.9548C8.21908 30.9548 8.15789 31.0000 8.15789 28.6050C8.15789 27.6334 8.25987 26.8652 8.40263 26.7070C8.72895 26.3455 10.8500 26.3455 11.1763 26.7070C11.3191 26.8652 11.4211 27.6334 11.4211 28.6050C11.4211 31.0000 11.3599 30.9548 15.5000 30.9548C18.3553 30.9548 18.9875 30.8870 19.2526 30.5933C19.5382 30.2770 19.5789 28.9213 19.5789 19.0926C19.5789 9.26385 19.5382 7.90817 19.2526 7.59184C19.0895 7.38849 18.8855 7.23032 18.8039 7.23032C18.7224 7.23032 17.1928 8.20190 15.3980 9.39942Z" /><path d="M23.1684 11.4329C22.8829 11.7267 22.8421 12.9242 22.8421 21.0131C22.8421 29.1020 22.8829 30.2996 23.1684 30.5933C23.6375 31.1356 30.2046 31.1356 30.6737 30.5933C30.9592 30.2996 31.0000 29.1020 31.0000 21.0131C31.0000 12.9242 30.9592 11.7267 30.6737 11.4329C30.4086 11.1392 29.7763 11.0714 26.9211 11.0714C24.0658 11.0714 23.4336 11.1392 23.1684 11.4329Z" /></svg>`,
        'exclave': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M10.238 28.828c-1.39-.144-3.39-.8-3.718-1.215-.16-.207-.176-.363-.176-1.593 0-.754.035-1.391.078-1.418.047-.028.387.152.754.398 1.414.945 2.539 1.285 4.258 1.29 1.02.003 1.308-.028 1.875-.204a7.706 7.706 0 0 0 3.914-2.766c.734-.996 1.082-1.8 1.32-3.078.117-.613.117-.77 0-1.344-.492-2.375-1.898-4.054-3.93-4.691-.66-.207-1.836-.18-2.504.059-1.234.441-2.207 1.25-2.668 2.222-.242.512-.285.703-.285 1.278 0 .578.04.754.293 1.265.317.64.926 1.266 1.512 1.551.52.254 1.434.277 1.875.055.61-.313 1.191-1.11 1.32-1.817.172-.91-.64-1.953-1.523-1.953-.27 0-.395.07-.695.383-.204.21-.512.582-.684.828-.262.367-.367.45-.625.469-.504.043-.672-.145-.664-.754.012-.996.601-1.863 1.547-2.293.636-.285 1.851-.266 2.523.043 1.406.652 2.043 2.008 2.043 4.355 0 2.004-.578 2.848-2.277 3.32-.918.259-2.399.278-3.262.048-1.812-.489-3-1.625-3.637-3.485-.226-.664-.246-.832-.246-2.02.004-1.179.028-1.363.258-2.054.379-1.133.746-1.762 1.406-2.418.684-.68 1.72-1.242 2.7-1.469 1.472-.34 3.464-.336 4.835.008 1.715.43 3.344 1.738 4.274 3.434 1.512 2.758 1.344 6.918-.383 9.457-.973 1.437-2.305 2.511-4.043 3.265-1.16.5-2.02.73-3.21.852-.997.102-1.235.102-2.255-.008Z"/><path d="M22.02 28.418c-.31-.074-.774-.484-.903-.793-.172-.41-.16-1.41.02-1.79.078-.167.265-.39.41-.495.25-.176.363-.188 2.015-.172.961.008 1.782.039 1.82.062.044.024.075.727.075 1.563v1.516l-.227.086c-.23.085-2.87.105-3.21.023Z"/><path d="M27.621 26.48l.027-1.91.293-.367c.743-.922.954-1.785.887-3.629-.058-1.62-.215-2.41-.762-3.828l-.418-1.082-.054-6.969.277.313c1.188 1.344 2.82 4.656 3.48 7.058.708 2.57.82 6.164.27 8.375-.379 1.497-1.305 2.868-2.293 3.391-.496.262-1.351.559-1.613.559-.102 0-.117-.336-.094-1.91Z"/><path d="M3.438 25.496c-1.016-1.035-1.602-1.933-2.278-3.492-.707-1.625-.972-2.762-1.117-4.777-.121-1.665.281-4.286.902-5.918.688-1.805 1.371-2.93 2.387-3.946.559-.554.727-.676.785-.57.04.07.082 1 .094 2.062l.016 1.93-.5 1.008c-.872 1.75-1.192 3.242-1.114 5.152.063 1.446.27 2.23.985 3.72l.554 1.163.028 2.121c.02 1.574 0 2.121-.078 2.121-.055 0-.356-.258-.665-.574Z"/><path d="M24.934 10.875c-.168-.242-.633-.754-1.036-1.133-2.89-2.726-6.75-4.035-11.066-3.762-2.043.13-3.496.567-4.95 1.485-1.241.785-1.35.848-1.448.785-.055-.035-.09-.586-.09-1.441 0-1.63.05-1.79.687-2.09 1.328-.625 3.844-1.399 5.387-1.653 1.836-.304 4.367-.265 6.133.094 1.789.363 4.277 1.414 5.742 2.422 1.215.836 1.18.73 1.148 3.352-.015 1.32-.062 2.246-.117 2.296-.058.06-.191-.062-.39-.355Z"/></svg>`,
        'koala-clash': `<svg class="w-6 h-6" viewBox="0 0 36 36" xmlns="http://www.w3.org/2000/svg" fill="none"><mask id="koala-clash-mask" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="white"/><path d="M9.554 9.854A9.26 9.26 0 0 0 8.6 9.8C5.507 9.8 3 11.293 3 15.026c0 2.154.838 3.808 2.138 4.824c.473-3.797 2.005-7.416 4.416-9.996zM27.4 9.8c-.317 0-.637.021-.955.054c2.412 2.58 3.943 6.199 4.416 9.997C32.162 18.834 33 17.181 33 15.026c0-3.733-2.507-5.226-5.6-5.226z" fill="black"/><path d="M21.728 24.807C21.728 28.152 20 29 18 29s-3.727-.848-3.727-4.193c0-3.345 1.727-6.057 3.727-6.057s3.728 2.712 3.728 6.057z" fill="black"/><circle cx="12.5" cy="19.875" r="1.5" fill="black"/><circle cx="23.5" cy="19.875" r="1.5" fill="black"/></mask><path fill="currentColor" mask="url(#koala-clash-mask)" d="M36 13.533C36 8.867 32.866 7 29 7c-1.621 0-3.285.354-4.676 1.027C22.523 6.798 20.405 6.062 18 6.062s-4.523.736-6.324 1.965C10.285 7.354 8.621 7 7 7c-3.866 0-7 1.867-7 6.533c0 3.844 2.128 6.417 5.038 7.206a20.141 20.141 0 0 0-.068 1.611c0 5.729 4.52 7.675 8.581 8.326C14.649 31.487 16.232 32 18 32s3.351-.513 4.449-1.323c4.062-.651 8.581-2.597 8.581-8.326c0-.538-.025-1.075-.068-1.611c2.91-.79 5.038-3.363 5.038-7.207z" /></svg>`,
        'android': `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M6,18c0,0.55 0.45,1 1,1h1v3.5c0,0.83 0.67,1.5 1.5,1.5s1.5,-0.67 1.5,-1.5V19h2v3.5c0,0.83 0.67,1.5 1.5,1.5s1.5,-0.67 1.5,-1.5V19h1c0.55,0 1,-0.45 1,-1V8H6v10zM3.5,8C2.67,8 2,8.67 2,9.5v7c0,0.83 0.67,1.5 1.5,1.5S5,17.33 5,16.5v-7C5,8.67 4.33,8 3.5,8zM20.5,8C19.67,8 19,8.67 19,9.5v7c0,0.83 0.67,1.5 1.5,1.5s1.5,-0.67 1.5,-1.5v-7C22,8.67 21.33,8 20.5,8zM15.53,2.16l1.3,-1.3c0.2,-0.2 0.2,-0.51 0,-0.71c-0.2,-0.2 -0.51,-0.2 -0.71,0l-1.48,1.48C13.85,1.23 12.95,1 12,1c-0.96,0 -1.86,0.23 -2.66,0.63L7.85,0.15c-0.2,-0.2 -0.51,-0.2 -0.71,0c-0.2,0.2 -0.2,0.51 0,0.71l1.31,1.31C6.97,3.26 6,5.01 6,7h12C18,5.01 17.03,3.25 15.53,2.16zM10,5H9V4h1V5zM15,5h-1V4h1V5z"/></svg>`,
        'ios': `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M18.71,19.5C17.88,20.74 17,21.95 15.66,21.97C14.32,22.00 13.89,21.18 12.37,21.18C10.84,21.18 10.37,21.95 9.09,22.00C7.79,22.05 6.80,20.68 5.96,19.47C4.25,17.00 2.94,12.45 4.70,9.39C5.57,7.87 7.13,6.91 8.82,6.88C10.10,6.86 11.32,7.75 12.11,7.75C12.89,7.75 14.37,6.68 15.92,6.84C16.57,6.87 18.39,7.10 19.56,8.82C19.47,8.88 17.39,10.10 17.41,12.63C17.44,15.65 20.06,16.66 20.09,16.67C20.06,16.74 19.67,18.11 18.71,19.5M13,3.5C13.73,2.67 14.94,2.04 15.94,2.00C16.07,3.17 15.60,4.35 14.90,5.19C14.21,6.04 13.07,6.70 11.95,6.61C11.80,5.46 12.36,4.26 13,3.5Z"/></svg>`,
        'windows': `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M2,4v7.5h9.5V2H3.5C2.67,2,2,2.67,2,3.5V4z M2,12.5v7.5C2,21.33,2.67,22,3.5,22H11.5V12.5H2z M12.5,2v9.5H22V3.5 C22,2.67,21.33,2,20.5,2H12.5z M12.5,12.5V22h8c0.83,0,1.5-0.67,1.5-1.5v-8H12.5z" /></svg>`,
        'macos': `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M18.71,19.5C17.88,20.74 17,21.95 15.66,21.97C14.32,22.00 13.89,21.18 12.37,21.18C10.84,21.18 10.37,21.95 9.09,22.00C7.79,22.05 6.80,20.68 5.96,19.47C4.25,17.00 2.94,12.45 4.70,9.39C5.57,7.87 7.13,6.91 8.82,6.88C10.10,6.86 11.32,7.75 12.11,7.75C12.89,7.75 14.37,6.68 15.92,6.84C16.57,6.87 18.39,7.10 19.56,8.82C19.47,8.88 17.39,10.10 17.41,12.63C17.44,15.65 20.06,16.66 20.09,16.67C20.06,16.74 19.67,18.11 18.71,19.5M13,3.5C13.73,2.67 14.94,2.04 15.94,2.00C16.07,3.17 15.60,4.35 14.90,5.19C14.21,6.04 13.07,6.70 11.95,6.61C11.80,5.46 12.36,4.26 13,3.5Z"/></svg>`,
        'linux': `<svg class="w-6 h-6" viewBox="0 0 32 32" fill="currentColor"><path d="M18.622 9.25c.061-.119.282-.138.282-.019 0 .113-.404.413-.95.713-.508.276-1.813.789-2.276.889-.888.194-1.928-.068-2.907-.744-.425-.294-.637-.57-.516-.67.025-.017.29.158.592.394 1.298 1.014 2.451 1.145 4.083.463.523-.219 1.631-.888 1.692-1.026ZM14.258 8.03c.167-.082.524-.088.585-.007.06.075-.463.257-.607.213-.152-.05-.145-.132.022-.207ZM15.753 8.023c.099-.131.722-.024.722.12 0 .106-.228.124-.493.03-.152-.05-.251-.118-.229-.15Z"/> <path d="M15.64.608c.804-.112 2.437-.082 3.074.056 1.601.35 2.755 1.22 3.385 2.56.516 1.113.683 2.14.706 4.487.023 1.344.053 1.814.151 2.158.258.901 1.086 2.047 2.505 3.474 2.095 2.102 3.264 3.836 3.818 5.67.182.606.205.794.205 1.713-.008.864-.03 1.114-.167 1.534-.099.287-.137.506-.099.52.205.055.714.413.873.62.106.131.311.606.455 1.063.288.9.532 1.332.964 1.77.38.376.66.826.714 1.152.137.726-.327 1.14-2.095 1.865-1.57.65-1.996.895-2.861 1.627-.752.638-1.64 1.177-2.33 1.408-1.245.426-2.52.313-3.469-.307-.35-.225-.858-.838-.934-1.114-.053-.187-.053-.187-.577-.187-.288 0-1.024-.062-1.646-.131-1.382-.163-2.3-.163-3.43.006-.48.069-1.178.169-1.558.225-.546.075-.705.12-.789.232a5.796 5.796 0 0 1-.539.488c-.591.488-1.07.631-2.163.669-1.017.031-1.79-.1-2.853-.494-1.146-.42-1.875-.608-2.801-.714-2.467-.275-2.96-.394-3.461-.807-.539-.438-.608-1.001-.251-1.946.137-.363.152-.526.114-.97-.144-1.727-.144-1.684-.008-1.984.266-.57.51-.713 2.24-1.345.372-.137.501-.244 1.078-.845l.652-.695v-.8c0-1.246.304-2.279 1.116-3.787.646-1.201 1.92-2.866 3.233-4.223 1.875-1.934 2.399-3.336 2.209-5.858-.114-1.414-.114-2.24-.015-2.929.19-1.295.645-2.203 1.435-2.891.781-.688 1.768-1.088 3.119-1.27Zm7.848 21.978c-.061-.357-.16-.37-.51-.082-.515.425-.766 1.09-.887 2.416-.129 1.326-.213 1.758-.577 2.81-.637 1.839-.706 2.483-.334 3.103.721 1.208 2.361 1.496 4.13.732.41-.175.766-.413 1.487-1 1.085-.89 1.533-1.146 2.96-1.734 1.76-.726 2.125-.995 2.004-1.502-.06-.27-.456-.82-.873-1.208-.425-.4-.501-.532-.744-1.364-.395-1.308-.752-1.646-1.791-1.702l-.577-.032-.28.226c-.835.657-2.15 1.014-2.847.77-.539-.188-1.063-.826-1.162-1.433ZM6.5 22.397c-.888-.25-1.237-.106-2.17.876-.312.332-.653.652-.76.714-.106.07-.576.257-1.054.432-.971.35-1.237.52-1.427.926-.121.262-.122.332.015 1.239l.144.964-.205.582c-.235.67-.273 1.314-.09 1.527.303.357.744.463 2.466.613 1.518.126 2.27.281 3.339.688 1.374.526 1.845.626 2.961.626.925 0 .964-.006 1.457-.206.82-.332 1.207-.852 1.222-1.634.007-.613-.426-1.239-1.898-2.766-.683-.713-.971-1.089-1.73-2.253-.774-1.195-.987-1.457-1.405-1.814-.356-.3-.592-.439-.865-.514Zm13.017-11.814a3.61 3.61 0 0 1-.835.457c-.273.1-.668.25-.88.344-1.579.67-1.852.738-2.725.694-.645-.037-.888-.131-1.64-.644-.734-.494-1.03-.663-1.092-.614-.023.019-.046.139-.046.264 0 .35-.281 1.346-.577 2.102-.402 1.002-.781 1.765-1.677 3.38-1.138 2.052-1.533 3.116-1.678 4.524l-.06.544-.243-.344c-.357-.507-.486-.895-.524-1.608-.068-1.114.13-1.715 1.093-3.355.356-.606.637-1.125.607-1.145-.06-.05-.827 1.046-1.305 1.872-.698 1.207-.948 1.964-.948 2.922.007.713.083 1.026.394 1.558.319.526.903 1.001 1.958 1.583 1.1.6 2.004 1.246 2.467 1.746.432.482.538.639.652 1.014.182.613-.144 1.057-.842 1.139l-.372.044.395.413c.22.231.478.507.57.62.212.25 1.342.719 2.177.9.721.157 2.24.188 2.96.063 1.238-.213 2.756-.757 3.59-1.295.016-.009.13-.32.25-.695.152-.456.251-.95.297-1.52.136-1.502.311-2.272.623-2.773.212-.356.789-.838 1.085-.92.212-.056.25-.1.288-.325.151-.945 1.404-1.114 3.134-.42 1.017.407 1.473.808 1.473 1.277 0 .175.031.22.152.22.13 0 .152-.045.152-.301 0-.551-.638-1.102-1.807-1.565-.38-.15-.538-.244-.515-.306.022-.045.068-.307.09-.576.13-1.251-.478-2.785-1.601-4.068-.486-.55-1.124-1.132-1.245-1.132-.16 0-.076.126.334.507 1.54 1.42 2.232 3.241 1.814 4.762l-.12.438-.282-.038a4.589 4.589 0 0 0-.433-.037c-.136 0-.174-.07-.288-.507-.235-.9-.721-1.934-1.64-3.498-1.032-1.752-1.708-3.104-2.277-4.537-.212-.55-.432-1.102-.477-1.22l-.092-.22-.334.276Zm-3.073-3.004c-1.139-.325-2.11-.156-3.006.538a9.514 9.514 0 0 1-.934.62c-.561.332-.676.457-.676.757 0 .394.297.688 1.306 1.308 1.305.794 1.351.814 1.988.838.721.032 1.314-.119 2.118-.532.312-.156.828-.393 1.154-.53.933-.383 1.495-.884 1.495-1.315 0-.263-.531-.577-1.48-.883a9.348 9.348 0 0 1-1.138-.45 5.227 5.227 0 0 0-.827-.351Zm2.215-2.365c-.698-.276-1.548-.119-2.064.382-.334.319-.592.976-.562 1.426l.023.331.38.114c.553.162.57.156.57-.157 0-.569.477-1.226.895-1.226.258 0 .675.382.78.707.122.375.039.9-.166 1.082-.091.081-.151.163-.136.182.024.013.228.1.47.181l.426.156.151-.156c.395-.413.532-1.339.281-1.952-.182-.438-.638-.901-1.048-1.07Zm-5.517-.07c-.638 0-1.177.651-1.276 1.534-.053.494.077.97.38 1.39.25.35.402.406.615.212.12-.106.121-.131-.045-.356-.243-.338-.251-1.121-.016-1.384.205-.225.448-.257.684-.075.197.15.409.645.409.94v.174l.387-.169.395-.163-.054-.463c-.068-.694-.47-1.34-.956-1.546a1.654 1.654 0 0 0-.523-.094Z"/></svg>`,
        'androidTV': `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M21,3H3C1.89,3 1,3.89 1,5V17A2,2 0 0,0 3,19H8V21H16V19H21A2,2 0 0,0 23,17V5C23,3.89 22.11,3 21,3M21,17H3V5H21V17Z"/></svg>`,
        'appleTV': `<svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor"><path d="M21,3H3C1.89,3 1,3.89 1,5V17A2,2 0 0,0 3,19H8V21H16V19H21A2,2 0 0,0 23,17V5C23,3.89 22.11,3 21,3M21,17H3V5H21V17Z"/></svg>`
        };

        document.addEventListener('DOMContentLoaded', initializeApp);

        function initializeApp() {
            loadSettings();
            loadAppsConfig();
            loadPanelData();
        }

        function loadSettings() {
            const savedTheme = localStorage.getItem('theme') || 'auto';
            applyTheme(savedTheme);
            const savedLang = localStorage.getItem('lang') || getBrowserLanguage();
            setLanguage(savedLang);
        }
        
        function getBrowserLanguage() {
            const lang = (navigator.language || navigator.userLanguage).slice(0, 2);
            return translations[lang] ? lang : 'en';
        }

        function setTheme(theme) {
            localStorage.setItem('theme', theme);
            applyTheme(theme);
        }

        function applyTheme(theme) {
            const html = document.documentElement;
            const themeColorMeta = document.getElementById('themeColor');
            let isDark;
            if (theme === 'auto') {
                isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            } else {
                isDark = theme === 'dark';
            }
            html.classList.toggle('dark-theme', isDark);
            themeColorMeta.setAttribute('content', isDark ? '#0f172a' : '#3b82f6');
        }

        function setLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('lang', lang);
            updateTexts();
            if (panelData?.response?.isFound) {
                renderContent();
            }
        }
        
        function setupLanguageButtons() {
            const container = document.getElementById('languageButtons');
            container.innerHTML = '';
            const baseLangs = ['en'];
            const additionalLangs = appsConfig?.config?.additionalLocales || [];
            const allLangs = [...new Set([...baseLangs, ...additionalLangs])];

            allLangs.forEach(langCode => {
                if (langFullNames[langCode]) {
                    const button = document.createElement('button');
                    button.className = 'btn';
                    button.textContent = langFullNames[langCode];
                    button.onclick = () => setLanguage(langCode);
                    container.appendChild(button);
                }
            });
        }

        function updateTexts() {
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (translations[currentLanguage]?.[key]) {
                    el.textContent = t(key);
                }
            });
        }

        function t(key) { return translations[currentLanguage]?.[key] || translations.en[key] || key; }

        function detectOS() {
            const ua = navigator.userAgent;
            const platform = navigator.platform;
            if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) return 'ios';
            if (/Android/.test(ua)) return 'android';
            if (/Mac/.test(platform)) return 'macos';
            if (/Win/.test(platform)) return 'windows';
            if (/Linux/.test(platform)) return 'linux';
            return 'windows'; // Default fallback
        }

        function loadAppsConfig() {
            fetch('/assets/app-config.json')
                .then(response => {
                    if (!response.ok) {
                        return Promise.reject(`Failed to load with status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    appsConfig = data;
                    branding = data.config?.branding || null;
                    validPlatforms = Object.keys(appsConfig.platforms || {}).filter(p => appsConfig.platforms[p] && appsConfig.platforms[p].length > 0);
                    setupLanguageButtons();
                    updateBranding(); // Добавляем обновление брендинга
                })
                .catch(error => {
                    console.error('Error loading apps config:', error);
                })
                .finally(() => {
                    if (panelData) {
                        renderContent();
                    }
                });
        }

        function updateBranding() {
            if (!branding) return;
            
            // Добавляем логотип если есть logoUrl
            if (branding.logoUrl) {
                const logo = document.querySelector('.logo');
                if (logo && !logo.querySelector('.brand-logo')) {
                    const logoImg = document.createElement('img');
                    logoImg.src = branding.logoUrl;
                    logoImg.alt = branding.name || 'Logo';
                    logoImg.className = 'brand-logo';
                    logoImg.style.cssText = 'height: 32px; width: auto; margin-right: 12px; border-radius: 4px;';
                    logo.style.display = 'flex';
                    logo.style.alignItems = 'center';
                    logo.insertBefore(logoImg, logo.firstChild);
                }
            }
            
            // Добавляем кнопку поддержки если есть supportUrl
            if (branding.supportUrl) {
                const controls = document.querySelector('.controls');
                if (controls && !controls.querySelector('.support-btn')) {
                    const supportBtn = document.createElement('button');
                    supportBtn.className = 'btn btn-icon support-btn';
                    supportBtn.onclick = () => {
                        try {
                            if (window.Telegram?.WebApp) {
                                window.Telegram.WebApp.openLink(branding.supportUrl);
                            } else {
                                window.open(branding.supportUrl, '_blank');
                            }
                        } catch (error) {
                            console.error('Failed to open support URL:', error);
                            window.open(branding.supportUrl, '_blank');
                        }
                    };
                    
                    // Проверяем, начинается ли URL с https://t.me
                    const isTelegramUrl = branding.supportUrl.startsWith('https://t.me');
                    const iconSvg = isTelegramUrl 
                        ? `<svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                        </svg>`
                        : `<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>`;
                    
                    supportBtn.innerHTML = `
                        ${iconSvg}
                        <span class="btn-text" data-key="support">Support</span>
                    `;
                    // Вставляем кнопку поддержки перед кнопкой настроек
                    const settingsBtn = controls.querySelector('button');
                    controls.insertBefore(supportBtn, settingsBtn);
                }
            }
        }

        function loadPanelData() {
            const panelDataB64 = '<%= panelData %>';
            try {
                panelData = JSON.parse(atob(panelDataB64));
            } catch (error) {
                console.error('Error loading panel data:', error);
                panelData = { response: { isFound: false } };
            }
            if (appsConfig !== null) renderContent();
        }

        function renderContent() {
            const mainContent = document.getElementById('mainContent');
            if (!panelData?.response?.isFound) {
                mainContent.innerHTML = `<div class="card error-card"><h3>${t('no_data')}</h3></div>`;
                return;
            }
            mainContent.innerHTML = renderUserInfo() + renderAppsSection() + renderLinksSection();
            updateTexts();
            updateBranding(); // Добавляем это здесь
            attachEventListeners();
        }

        function renderUserInfo() {
            const { user } = panelData.response;
            const expiresDate = new Date(user.expiresAt);
            const isNeverExpires = expiresDate.getFullYear() >= 2099;
            const trafficLimitText = user.trafficLimit === "0" ? t('unlimited') : user.trafficLimit;
            const isActive = user.userStatus.toLowerCase() === 'active';
            
            let userInfoRows = `
                <div class="info-row"><span class="info-label">${t('username')}</span><span class="info-value">${escapeHtml(user.username)}</span></div>
                <div class="info-row"><span class="info-label">${t('status')}</span><span class="badge badge-${user.userStatus.toLowerCase()}">${t(user.userStatus)}</span></div>
            `;
            
            // Показываем дополнительные строки только если статус ACTIVE
            if (isActive) {
                userInfoRows += `
                    <div class="info-row"><span class="info-label">${t('expires_at')}</span><span class="info-value">${isNeverExpires ? t('never_expires') : formatDate(expiresDate)}</span></div>
                    ${!isNeverExpires ? `<div class="info-row"><span class="info-label">${t('days_left')}</span><span class="info-value">${user.daysLeft}</span></div>` : ''}
                    <div class="info-row"><span class="info-label">${t('traffic_used')}</span><span class="info-value">${user.trafficUsed} / ${trafficLimitText}</span></div>
                    <div class="info-row"><span class="info-label">${t('traffic_reset')}</span><span class="info-value">${t(user.trafficLimitStrategy)}</span></div>
                `;
            }
            
            return `
                <div class="card user-info"><div class="card-content">
                    ${userInfoRows}
                </div></div>`;
        }

        function renderLinksSection() {
            const { links } = panelData.response;
            if (!links?.length) return '';
            return `<div class="card links-section"><div class="card-header"><span>${t('subscription_links')}</span></div><div class="card-content">${links.map(link => `<div class="link-item"><div class="link-info"><div class="link-name">${escapeHtml(extractLinkName(link))}</div></div><div class="link-actions"><button class="btn btn-sm copy-btn" data-copy-text="${escapeHtml(link)}"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg><span class="btn-icon-text">${t('copy')}</span></button><button class="btn btn-sm qr-btn" data-qr-text="${escapeHtml(link)}" data-qr-title="${escapeHtml(extractLinkName(link))}"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"/></svg><span class="btn-icon-text">${t('qr_code')}</span></button></div></div>`).join('')}</div></div>`;
        }

        function renderAppSteps(app) {
            const { response } = panelData || {};
            if (!response) return '<div class="step"><div class="step-description">No data available</div></div>';
            
            // Создаем объект с данными для передачи в renderStep
            const stepData = {
                subscriptionUrl: response.subscriptionUrl,
                cryptoLink: response.happ?.cryptoLink || response.cryptoLink // Используем happ.cryptoLink для приложения happ
            };
            
            let stepsHtml = '';
            let stepCounter = 1;
            
            // Шаг установки
            if (app.installationStep) {
                stepsHtml += renderStep(app.installationStep, 'installationStep', app, stepData, stepCounter++);
            }
            
            // Дополнительный шаг ПЕРЕД добавлением подписки
            if (app.additionalBeforeAddSubscriptionStep) {
                stepsHtml += renderStep(app.additionalBeforeAddSubscriptionStep, 'additionalBeforeAddSubscriptionStep', app, stepData, stepCounter++);
            }
            
            // Шаг добавления подписки
            if (app.addSubscriptionStep) {
                stepsHtml += renderStep(app.addSubscriptionStep, 'addSubscriptionStep', app, stepData, stepCounter++);
            }
            
            // Дополнительный шаг ПОСЛЕ добавления подписки
            if (app.additionalAfterAddSubscriptionStep) {
                stepsHtml += renderStep(app.additionalAfterAddSubscriptionStep, 'additionalAfterAddSubscriptionStep', app, stepData, stepCounter++);
            }
            
            // Шаг подключения и использования
            if (app.connectAndUseStep) {
                stepsHtml += renderStep(app.connectAndUseStep, 'connectAndUseStep', app, stepData, stepCounter++);
            }
            
            return stepsHtml || '<div class="step"><div class="step-description">No setup steps available</div></div>';
        }

        function getStepNumber(stepKey, stepNumber) {
            // Используем переданный номер шага вместо фиксированных значений
            return stepNumber ? stepNumber.toString() : '1';
        }

        function getStepTitle(stepKey, stepConfig) {
            // Для дополнительных шагов используем title из самого stepConfig
            if (stepKey === 'additionalBeforeAddSubscriptionStep' || stepKey === 'additionalAfterAddSubscriptionStep') {
                if (stepConfig?.title) {
                    // title может быть объектом с переводами или строкой
                    if (typeof stepConfig.title === 'object') {
                        return stepConfig.title[currentLanguage] || stepConfig.title.en || t('additional_step');
                    } else {
                        return stepConfig.title;
                    }
                }
                return t('additional_step');
            }
            
            // Для обычных шагов используем стандартные переводы
            const stepTitles = {
                'installationStep': t('install_app'),
                'addSubscriptionStep': t('add_subscription'),
                'connectAndUseStep': t('connect_use')
            };
            
            return stepTitles[stepKey] || t('step');
        }

        function renderAppsSection() {
            if (!appsConfig?.platforms || validPlatforms.length === 0) return '';
            
            const storedPlatform = localStorage.getItem('platform');
            currentPlatform = validPlatforms.includes(storedPlatform) ? storedPlatform : detectOS();
            if (!validPlatforms.includes(currentPlatform)) {
                currentPlatform = validPlatforms[0];
            }

            return `<div class="card apps-section">
                <div class="card-header">
                    <span data-key="available_apps">${t('available_apps')}</span>
                    <button class="btn" id="platform-selector-btn" onclick="openPlatformModal()">
                        ${getAppIcon({id: currentPlatform}, currentPlatform)} <span>${t(currentPlatform)}</span>
                    </button>
                </div>
                <div class="card-content">
                    <div class="platform-tabs">
                        ${validPlatforms.map(p => `<div class="platform-tab ${p === currentPlatform ? 'active' : ''}" data-platform="${p}">${getAppIcon({id: p}, p)} ${t(p)}</div>`).join('')}
                    </div>
                    <div id="appsGrid">${renderAppsForPlatform()}</div>
                </div>
            </div>`;
        }
        
        function renderAppsForPlatform() {
            const apps = appsConfig.platforms[currentPlatform] || [];
            const featuredApps = apps.filter(app => app.isFeatured);
            const otherApps = apps.filter(app => !app.isFeatured);
            let html = '<div class="apps-container">';
            if (featuredApps.length > 0) html += `<div class="featured-apps-row">${featuredApps.map(renderAppCard).join('')}</div>`;
            if (otherApps.length > 0) html += `<div class="other-apps-spoiler"><div class="spoiler-header"><span>${t('other_apps')}</span><svg class="w-4 h-4 spoiler-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg></div><div class="spoiler-content"><div class="apps-grid">${otherApps.map(renderAppCard).join('')}</div></div></div>`;
            html += '</div>';
            return html;
        }

        function renderAppCard(app) {
            return `<div class="app-card ${app.isFeatured ? 'featured' : ''}" data-app-id="${app.id}">${app.isFeatured ? `<div class="featured-badge">${t('featured')}</div>` : ''}<div class="app-header"><div class="app-icon">${getAppIcon(app, currentPlatform)}</div><div class="app-name">${escapeHtml(app.name)}</div></div><div class="btn btn-primary" style="width: 100%; justify-content: center;">${t('install_app')}</div></div>`;
        }

        function getAppIcon(app, platform) {
            const appId = app.id?.toLowerCase();
            if (appIcons[appId]) return appIcons[appId];
            if (appId?.includes('flclashx')) return appIcons['flclashx'];
            if (appId?.includes('flclash')) return appIcons['flclash'];
            if (appId?.includes('clash-verge')) return appIcons['clash-verge'];
            if (appId?.includes('clash')) return appIcons['clash-meta'];
            if (appId?.includes('v2ray')) return appIcons['v2rayng'];
            return appIcons[platform] || appIcons['windows'];
        }

        function renderStep(stepConfig, stepKey, app, data, stepNumber) {
            if (!stepConfig) return '';
            
            const stepNum = getStepNumber(stepKey, stepNumber);
            const stepTitle = getStepTitle(stepKey, stepConfig);
            
            let buttonsHtml = '';
            
            if (stepConfig.buttons) {
                buttonsHtml = stepConfig.buttons.map(button => {
                    const buttonText = button.buttonText?.[currentLanguage] || button.buttonText?.en || 'Open';
                    return `<button class="btn btn-primary" onclick="openLink('${button.buttonLink}')">${buttonText}</button>`;
                }).join('');
            }
            
            // Добавляем кнопку подписки для addSubscriptionStep
            if (stepKey === 'addSubscriptionStep') {
                let finalUrl = '#';
                
                // Проверяем, работаем ли мы внутри Telegram WebApp
                const isInTelegram = window.Telegram?.WebApp?.initData;
                
                // Базовая redirect ссылка используется ТОЛЬКО в Telegram WebApp
                const REDIRECT_BASE = 'https://legiz-ru.github.io/Orion/redirect-page/?redirect_to=';
                
                if (app.id === 'happ') {
                    // Для приложения happ используем cryptoLink из panelData.response.happ
                    const happCryptoLink = panelData?.response?.happ?.cryptoLink;
                    if (happCryptoLink) {
                        if (isInTelegram) {
                            // В Telegram используем redirect
                            const redirectPrefix = (app.redirectLink && app.redirectLink.trim() !== "") 
                                ? app.redirectLink 
                                : REDIRECT_BASE;
                            finalUrl = redirectPrefix + encodeURIComponent(happCryptoLink);
                        } else {
                            // Вне Telegram используем прямую ссылку
                            finalUrl = happCryptoLink;
                        }
                    }
                } else {
                    // Для других приложений
                    if (app.urlScheme && data.subscriptionUrl) {
                        let subscriptionPart = data.subscriptionUrl;
                        if (app.isNeedBase64Encoding) {
                            subscriptionPart = btoa(subscriptionPart);
                        }
                        
                        const appUrl = app.urlScheme + subscriptionPart;
                        
                        if (isInTelegram) {
                            // В Telegram используем redirect
                            const redirectPrefix = (app.redirectLink && app.redirectLink.trim() !== "") 
                                ? app.redirectLink 
                                : REDIRECT_BASE;
                            finalUrl = redirectPrefix + encodeURIComponent(appUrl);
                        } else {
                            // Вне Telegram используем прямую ссылку
                            finalUrl = appUrl;
                        }
                    }
                }
                
                if (finalUrl !== '#') {
                    const escapedUrl = escapeForAttribute(finalUrl);
                    const addSubscriptionButton = `<button class="btn btn-primary" onclick="openSubscriptionUrl('${escapedUrl}')">${t('add_subscription')}</button>`;
                    buttonsHtml += addSubscriptionButton;
                }
            }
            
            const description = stepConfig.description?.[currentLanguage] || stepConfig.description?.en || '';
            
            return `
                <div class="step">
                    <div class="step-title">
                        <span class="step-number">${stepNum}</span> 
                        ${stepTitle}
                    </div>
                    <div class="step-description">${escapeHtml(description)}</div>
                    <div class="step-buttons">${buttonsHtml}</div>
                </div>
            `;
        }

        function openLink(url) {
            try {
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.openLink(url);
                } else {
                    window.open(url, '_blank');
                }
            } catch (error) {
                console.error('Failed to open URL:', error);
                window.open(url, '_blank');
            }
        }

        function openSubscriptionUrl(url) {
            if (url === '#' || !url) {
                console.warn('Invalid subscription URL:', url);
                return;
            }
            
            console.log('Opening subscription URL:', url);
            console.log('Is in Telegram:', !!window.Telegram?.WebApp?.initData);
            
            try {
                if (window.Telegram?.WebApp?.initData) {
                    // В Telegram WebApp используем специальный метод
                    console.log('Using Telegram WebApp openLink');
                    window.Telegram.WebApp.openLink(url);
                } else {
                    // Вне Telegram используем обычное открытие
                    console.log('Using window.open');
                    window.open(url, '_blank');
                }
            } catch (error) {
                console.error('Failed to open subscription URL:', error);
                // В случае ошибки показываем ссылку для копирования
                if (window.prompt) {
                    prompt('Скопируйте эту ссылку:', url);
                } else {
                    console.log('Fallback URL:', url);
                }
            }
        }

        function getSubscriptionLinkForApp(app) {
            const { response } = panelData || {};
            const redirect_link = 'https://legiz-ru.github.io/Orion/redirect-page/?redirect_to=';
            if (!response) return '#';
            if (app.id.toLowerCase() === 'happ' && response.happ?.cryptoLink) return redirect_link + response.happ.cryptoLink;
            if (!app.urlScheme || !response.subscriptionUrl) return '#';
            let url = response.subscriptionUrl;
            if (app.isNeedBase64Encoding) try { url = btoa(url); } catch (e) { return '#'; }
            return redirect_link + app.urlScheme + encodeURIComponent(url);
        }

        function getLocalizedText(textObj) { return textObj?.[currentLanguage] || textObj?.['en'] || (typeof textObj === 'string' ? textObj : ''); }
        
        function throttle(func, limit) {
            let inThrottle;
            return function() {
                const args = arguments;
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        const throttledSwitchPlatform = throttle(switchPlatform, 200);

        function attachEventListeners() {
            document.querySelectorAll('.platform-tab').forEach(tab => {
                tab.addEventListener('click', (e) => {
                    const platform = e.currentTarget.dataset.platform;
                    if (platform) throttledSwitchPlatform(platform);
                });
            });
            document.querySelectorAll('.app-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const appId = e.currentTarget.dataset.appId;
                    const app = appsConfig.platforms[currentPlatform]?.find(a => a.id === appId);
                    if (app) showAppSetupModal(app);
                });
            });
            document.querySelectorAll('.copy-btn').forEach(btn => {
                btn.addEventListener('click', (e) => copyToClipboard(e.currentTarget.dataset.copyText));
            });
            document.querySelectorAll('.qr-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const { qrText, qrTitle } = e.currentTarget.dataset;
                    showQrModal(qrText, qrTitle);
                });
            });
            document.querySelectorAll('.spoiler-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    const content = e.currentTarget.nextElementSibling;
                    const arrow = e.currentTarget.querySelector('.spoiler-arrow');
                    content.classList.toggle('open');
                    arrow.classList.toggle('open');
                });
            });
            window.addEventListener('resize', checkTabsOverflow);
            checkTabsOverflow();
        }
        
        function checkTabsOverflow() {
            const tabs = document.querySelector('.platform-tabs');
            const button = document.getElementById('platform-selector-btn');
            if (!tabs || !button) return;

            if (window.matchMedia('(max-width: 768px)').matches) {
                return; // CSS handles mobile view
            }

            const isOverflowing = tabs.scrollWidth > tabs.parentElement.clientWidth;

            if (isOverflowing) {
                tabs.style.display = 'none';
                button.style.display = 'inline-flex';
            } else {
                tabs.style.display = 'flex';
                button.style.display = 'none';
            }
        }

        function openPlatformModal() {
            const modalBody = document.getElementById('platformModalBody');
            modalBody.innerHTML = `<div class="platform-modal-list">
                ${validPlatforms.map(p => `
                    <div class="platform-modal-item" data-platform="${p}">
                        ${getAppIcon({id: p}, p)}
                        <span>${t(p)}</span>
                    </div>
                `).join('')}
            </div>`;
            
            modalBody.querySelectorAll('.platform-modal-item').forEach(item => {
                item.addEventListener('click', (e) => {
                    const platform = e.currentTarget.dataset.platform;
                    switchPlatform(platform);
                    closeModal('platformModal');
                });
            });

            openModal('platformModal');
        }

        function switchPlatform(platform) {
            if (!platform || platform === currentPlatform) return;
            currentPlatform = platform;
            localStorage.setItem('platform', platform);

            document.querySelectorAll('.platform-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.platform === platform);
            });
            
            const appsGrid = document.getElementById('appsGrid');
            appsGrid.innerHTML = renderAppsForPlatform();
            
            const button = document.getElementById('platform-selector-btn');
            if (button) {
                button.innerHTML = `${getAppIcon({id: platform}, platform)} <span>${t(platform)}</span>`;
            }
            
            updateTexts();
            
            appsGrid.querySelectorAll('.app-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const appId = e.currentTarget.dataset.appId;
                    const app = appsConfig.platforms[currentPlatform]?.find(a => a.id === appId);
                    if (app) showAppSetupModal(app);
                });
            });
            appsGrid.querySelectorAll('.spoiler-header').forEach(header => {
                header.addEventListener('click', (e) => {
                    const content = e.currentTarget.nextElementSibling;
                    const arrow = e.currentTarget.querySelector('.spoiler-arrow');
                    content.classList.toggle('open');
                    arrow.classList.toggle('open');
                });
            });
        }
        
        function showAppSetupModal(app) {
            if (!app) return;
            
            console.log('Opening modal for app:', app);
            console.log('Panel data:', panelData);
            
            const titleEl = document.getElementById('appModalTitle');
            titleEl.innerHTML = `<div class="app-icon">${getAppIcon(app, currentPlatform)}</div><span>${escapeHtml(app.name)}</span>`;
            
            const modalBody = document.getElementById('appModalBody');
            const stepsHtml = renderAppSteps(app);
            console.log('Generated steps HTML:', stepsHtml);
            
            modalBody.innerHTML = stepsHtml;
            updateTexts();
            openModal('appModal');
        }

function escapeHtml(text) {
    if (typeof text !== 'string') return '';
    const div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
}

function escapeForAttribute(text) {
    if (typeof text !== 'string') return '';
    return text.replace(/"/g, '&quot;').replace(/'/g, '&#39;');
}
        
        function showQrModal(data, title) {
            if (!data) return;
            document.getElementById('qrModalTitle').textContent = title || t('qr_code');
            const qrContainer = document.getElementById('qrCode');
            qrContainer.innerHTML = '';
            try {
                const qr = qrcode(0, 'M');
                qr.addData(data);
                qr.make();
                qrContainer.innerHTML = qr.createImgTag(5, 10);
            } catch (e) {
                console.error('QR generation failed:', e);
                qrContainer.textContent = 'Error generating QR code.';
            }
            openModal('qrModal');
        }

        function showSubscriptionModal() {
            const url = panelData?.response?.subscriptionUrl;
            if (!url) return;
            const qrContainer = document.getElementById('subscriptionQrCode');
            qrContainer.innerHTML = '';
            try {
                const qr = qrcode(0, 'M');
                qr.addData(url);
                qr.make();
                qrContainer.innerHTML = qr.createImgTag(5, 10);
            } catch (e) {
                console.error('QR generation failed:', e);
                qrContainer.textContent = 'Error generating QR code.';
            }
            openModal('subscriptionModal');
        }

        function copySubscriptionUrl() {
            copyToClipboard(panelData?.response?.subscriptionUrl);
        }

        function copyToClipboard(text) {
            if (!text) {
                console.error("Attempted to copy empty text.");
                return;
            }
            navigator.clipboard.writeText(text)
                .catch(err => console.error('Could not copy text: ', err));
            showToast(t('copied'));
        }
        
        function showToast(message) {
            if (toastTimeout) clearTimeout(toastTimeout);
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            toastTimeout = setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }

        function openModal(id) { document.getElementById(id)?.classList.add('active'); }
        function closeModal(id) { document.getElementById(id)?.classList.remove('active'); }
        
        function extractLinkName(link) {
            try { return decodeURIComponent(new URL(link).hash.substring(1)); } 
            catch {
                const i = link.indexOf('#');
                if (i !== -1) try { return decodeURIComponent(link.substring(i + 1)); } catch {}
            }
            return 'Server Link';
        }

        function formatDate(d) { return new Date(d).toLocaleDateString(currentLanguage === 'ru' ? 'ru-RU' : currentLanguage === 'fa' ? 'fa-IR' : 'en-GB'); }
        function escapeHtml(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

        document.addEventListener('click', e => { if (e.target.classList.contains('modal')) e.target.classList.remove('active'); });
        document.addEventListener('keydown', e => { if (e.key === 'Escape') document.querySelectorAll('.modal.active').forEach(m => m.classList.remove('active')); });
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => { if (localStorage.getItem('theme') === 'auto') applyTheme('auto'); });
    </script>
</body>
</html>

